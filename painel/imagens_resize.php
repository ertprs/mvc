<?php$imagem_maior_x = 1440;$imagem_maior_y = 1080;// DEFINE A imagemy DA QUAL SERÁ GERADA A MINIATURA // Lembrar que essa imagemy tem que estar no diretório do script... // .. nenhum teste será feito para saber se ela existe$imagem_maior = $targetFile; // Tipo: JPG$fileName = $newFileName;if(substr($fileName,-3) == "gif" || substr($fileName,-3) == "png"){    if(substr($fileName,-3) == "gif"){        $img = imagecreatefromgif($imagem_maior);        }elseif(substr($fileName,-3) == "png"){        $img = imagecreatefrompng($imagem_maior);    }        $w = imagesx($img);    $h = imagesy($img);    $trans = imagecolortransparent($img);        if($trans >= 0){        $rgb = imagecolorsforindex($img, $trans);        $oldimg = $img;        $img = imagecreatetruecolor($w,$h);        $color = imagecolorallocate($img,$rgb['red'],$rgb['green'],$rgb['blue']);        imagefilledrectangle($img,0,0,$w,$h,$color);        imagecopy($img,$oldimg,0,0,0,0,$w,$h);    }        imagejpeg($img,str_replace(".gif",".jpg",str_replace(".png",".jpg",$imagem_maior)));}$imagem_maior=str_replace(".gif",".jpg",str_replace(".png",".jpg",str_replace(".bmp",".jpg",$imagem_maior)));// DEFINIR O NOME DO ARQUIVO PARA O thumbnail_maior$thumbnail_maior = $imagem_maior;// LÊ A imagem_maior DE ORIGEM$img_origem_maior = imagecreatefromjpeg($imagem_maior);// PEGA AS DIMENSÕES DA imagem_maior DE ORIGEM$origem_x_maior = imagesx($img_origem_maior); // Largura$origem_y_maior= imagesy($img_origem_maior); // Altura if($origem_x_maior > $imagem_maior_x or $origem_y_maior >$imagem_maior_y){     // DEFINIR AS DIMENSÕES PARA O thumbnail_maior    if($origem_x_maior > $origem_y_maior){        $x_maior = $imagem_maior_x; // Largura        $y_maior = $imagem_maior_y; // Altura        }else{        $x_maior = $imagem_maior_y; // Largura        $y_maior = $imagem_maior_x; // Altura    }    // ESCOLHE A LARGURA MAIOR E, BASEADO NELA, GERA A LARGURA MENOR    if($origem_x_maior > $origem_y_maior){ // Se a largura for maior que a altura        $final_x_maior = $x_maior; // A largura será a do thumbnail_maior        $final_y_maior = floor($x_maior * $origem_y_maior/ $origem_x_maior); // A altura é calculada        $f_x_maior = 0; // Colar no x = 0         }else{ // Se a altura for maior ou igual à largura        $final_x_maior = floor($y_maior * $origem_x_maior / $origem_y_maior); // Calcula a largura        $final_y_maior = $y_maior; // A altura será a do thumbnail_maior        $f_y_maior = 0; // Colar no y = 0    }    // CRIA A imagem_maior FINAL PARA O thumbnail_maior    $img_final_maior = imagecreatetruecolor($final_x_maior,$final_y_maior);     imagefill($img_final_maior, 0, 0, 0xFFFFFF);     // COPIA A imagem_maior ORIGINAL PARA DENTRO DO thumbnail_maior    imagecopyresampled ($img_final_maior, $img_origem_maior, $f_x_maior, $f_y_maior, 0, 0, $final_x_maior, $final_y_maior, $origem_x_maior, $origem_y_maior);    // SALVA O thumbnail_maior    imagejpeg($img_final_maior, $thumbnail_maior,80);      // LIBERA A MEMÓRIA    imagedestroy($img_origem_maior);    imagedestroy($img_final_maior);}foreach($thumbnail as $linha){    $imagemx = $targetFile;    $thumbnail = explode('.', $imagemx);    $thumbnail = $thumbnail[0].$linha['sufixo'];    $x = $linha['x'];    $y = $linha['y'];    //LÊ A imagemx DE ORIGEM    $img_origem = imagecreatefromjpeg($imagemx);    // PEGA AS DIMENSÕES DA imagemx DE ORIGEM    $origem_x = imagesx($img_origem); // Largura    $origem_y = imagesy($img_origem); // Altura    // ESCOLHE A LARGURA MAIOR E, BASEADO NELA, GERA A LARGURA MENOR    if($origem_x > $origem_y) { // Se a largura for maior que a altura        $final_x = floor($y * $origem_x / $origem_y); // A altura é calculada        $final_y = $y; // A altura é calculada        $f_x =  round(($x / 2) - ($final_x / 2));  // Colar no x = 0        $f_y = round(($y / 2) - ($final_y / 2)); // Centralizar a imagemx no meio y do thumbnail        // Se a altura for maior ou igual à largura    }else{        $final_x = $x; // Calcula a largura        $final_y = floor($x * $origem_y / $origem_x); // A altura será a do thumbnail        $f_x = 0; // Centraliza a imagemx no meio x do thumbnail        $f_y = floor(($y-$final_y)/2); // Colar no y = 0    }    // CRIA A imagemx FINAL PARA O THUMBNAIL    $img_final = imagecreatetruecolor($x,$y);     imagefill($img_final, 0, 0, 0xFFFFFF);     // COPIA A imagemx ORIGINAL PARA DENTRO DO THUMBNAIL    imagecopyresampled ($img_final, $img_origem, $f_x, $f_y, 0, 0, $final_x, $final_y, $origem_x, $origem_y);    // SALVA O THUMBNAIL    imagejpeg($img_final, $thumbnail,90);    // LIBERA A MEMÓRIA    imagedestroy($img_origem);    imagedestroy($img_final);}?>